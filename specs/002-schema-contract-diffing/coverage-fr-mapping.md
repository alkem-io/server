# FR to Implementation & Test Mapping â€“ Feature 002

Status: Complete (All FRs implemented; one nuance partial)

| Requirement          | Implementation Artifacts                                                                | Test Artifacts                                                     | Status                                                                        | Notes                                                                                                                                    |
| -------------------- | --------------------------------------------------------------------------------------- | ------------------------------------------------------------------ | ----------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| FR-001               | `schema:print` (`src/tools/schema/print-schema.ts`), snapshot `schema.graphql`          | Covered indirectly by diff tests baseline scenario                 | DONE                                                                          | Deterministic printer & sort ensure stable snapshot.                                                                                     |
| FR-002               | `diff-schema.ts` (type/field diff logic)                                                | `test/schema/diff-basic.spec.ts`, `diff-baseline.spec.ts`          | DONE                                                                          | Full taxonomy emitted: ADDITIVE, DEPRECATED, DEPRECATION_GRACE, INVALID_DEPRECATION_FORMAT, BREAKING, PREMATURE_REMOVAL, INFO, BASELINE. |
| FR-003               | `override.ts`, `override-fetch.ts`, integration in `diff-schema.ts` (`overrideApplied`) | `test/schema/override-eval.spec.ts`, `override-fetch.spec.ts`      | DONE                                                                          | Override applies to BREAKING & PREMATURE_REMOVAL; per-entry `override: true`.                                                            |
| FR-004               | Field removal path in `diffTypes`                                                       | `test/schema/diff-basic.spec.ts` (removal cases)                   | DONE                                                                          | Undeclared removals become BREAKING.                                                                                                     |
| FR-005               | `deprecations.json` generation in `diff-schema.ts`                                      | `test/schema/validate-artifacts.spec.ts`                           | DONE                                                                          | Includes element, sinceDate, removeAfter, firstCommit approximation.                                                                     |
| FR-006               | CI workflow `.github/workflows/schema-contract.yml`, PR comment script `schema-gate.ts` | Workflow execution (manual), `schema-gate.ts` logic indirectly     | DONE                                                                          | Artifacts uploaded + sticky comment.                                                                                                     |
| FR-007               | Description/reason diff -> INFO in `diffTypes`/`diffScalars`                            | `test/schema/diff-basic.spec.ts`, `diff-scalar.spec.ts`            | DONE                                                                          | Non-breaking textual changes recorded.                                                                                                   |
| FR-008               | Nullability check in `diffTypes`                                                        | `test/schema/diff-nullability.spec.ts`                             | DONE                                                                          | Narrowing flagged BREAKING; widening INFO.                                                                                               |
| FR-009               | Enum value removal classification in `diffEnums`                                        | `test/schema/diff-enum-removal.spec.ts`                            | DONE                                                                          | Removal without deprecation BREAKING.                                                                                                    |
| FR-010               | Enum addition classification in `diffEnums`                                             | (Covered by baseline/additive enum cases)                          | PARTIAL                                                                       | No special handling of re-adding previously deprecated value.                                                                            |
| FR-011               | Enum removal lifecycle (sinceDate + 90-day + removeAfter) in `diffEnums`                | `test/schema/__tests__/lifecycle-window.spec.ts`                   | DONE                                                                          | PREMATURE_REMOVAL vs allowed retirement.                                                                                                 |
| FR-012               | Window validation (<90d) in parser + diff                                               | `test/schema/diff-invalid-deprecation.spec.ts`                     | DONE                                                                          | Short window -> INVALID_DEPRECATION_FORMAT.                                                                                              |
| FR-013               | Deprecation parser format (`deprecation-parser.ts`)                                     | `test/schema/deprecation-parser.spec.ts`                           | DONE                                                                          | Enforces `REMOVE_AFTER=...                                                                                                               | reason`.                                                                                |
| FR-014               | Grace logic -> `DEPRECATION_GRACE` classification                                       | `src/tools/schema/__tests__/deprecation-grace.spec.ts`             | DONE                                                                          | 24h grace path tests.                                                                                                                    |
| FR-015               | Removal validation against prior snapshot                                               | `test/schema/diff-enum-removal.spec.ts`, `diff-basic.spec.ts`      | DONE                                                                          | Missing valid schedule -> BREAKING/PREMATURE.                                                                                            |
| FR-016               | `deprecationFormatValid` field on entries                                               | `validate-artifacts.spec.ts` schema validation                     | DONE                                                                          | JSON Schema requires boolean presence.                                                                                                   |
| FR-017               | Non-breaking scalar description/internal change classification                          | `diffScalars` logic, `test/schema/diff-scalar.spec.ts`             | DONE                                                                          | No jsonType change -> NON_BREAKING/INFO.                                                                                                 |
| FR-018               | Breaking scalar jsonType change                                                         | `diffScalars` logic                                                | `test/schema/diff-scalar.spec.ts`                                             | DONE                                                                                                                                     | jsonType change triggers BREAKING entry + evaluation.                                   |
| FR-019               | Scalar evaluation metadata (`scalarEvaluations`)                                        | `diffScalars` adds records; report augmentation in `buildReport`   | `test/schema/diff-scalar.spec.ts` (asserts presence)                          | DONE                                                                                                                                     | Provides previous/current jsonType + behavior classification.                           |
| FR-023               | JSON Schema validation of artifacts (`validate-artifacts.ts`)                           | `test/schema/validate-artifacts.spec.ts`, contract tests T006,T007 | DONE                                                                          | change-report.json & deprecations.json must pass committed schemas.                                                                      |
| FR-024               | Per-entry override flag for BREAKING & PREMATURE_REMOVAL                                | `apply-overrides.ts`, override logic in `diff-schema.ts`           | `test/schema/override-eval.spec.ts`, integration override tests T048,T069     | DONE                                                                                                                                     | Entries overridden include `override: true`; unaffected entries remain false/undefined. |
| FR-025               | Baseline classification & count                                                         | `buildBaselineReport` (`build-report.ts`)                          | `test/schema/diff-baseline.spec.ts`, baseline integration T046                | DONE                                                                                                                                     | Emits BASELINE entry & sets classifications.baseline=1.                                 |
| FR-026               | Performance budget (<5s synthetic diff)                                                 | Diff engine performance logic                                      | `test/schema/diff-performance.spec.ts`, perf large-schema T049                | DONE                                                                                                                                     | Current runtime << budget; test asserts <5000ms.                                        |
| FR-027               | Unknown scalar jsonType inference                                                       | `diff-scalar.ts` inference logic                                   | `test/schema/diff-scalar.spec.ts` (unknown case), scalar classification tests | DONE                                                                                                                                     | Uses name heuristic; falls back to `unknown` NON_BREAKING.                              |
| FR-028               | DEPRECATION_GRACE classification with `graceExpiresAt`                                  | Deprecation parser + diff integration                              | `test/schema/deprecation-parser.spec.ts` (grace), parser edge cases T042      | DONE                                                                                                                                     | Grace <24h emits DEPRECATION_GRACE + timestamp.                                         |
| FR-029               | Retirement metadata (`retired`, `retirementDate`) in deprecations registry              | `diff-enum.ts` / deprecation registry builder                      | Enum lifecycle tests T043,T064                                                | DONE                                                                                                                                     | INFO entry for valid retirement; registry marks retired=true.                           |
| FR-030               | Classification counts include `baseline` key                                            | `classification count` structure in model/types                    | `validate-artifacts.spec.ts` (counts), build-report tests                     | DONE                                                                                                                                     | `baseline` always present (0 unless BASELINE scenario).                                 |
| Performance Budget   | Synthetic perf test `diff-performance.spec.ts`                                          | `test/schema/diff-performance.spec.ts`                             | DONE                                                                          | <5s requirement (current ~0.8s).                                                                                                         |
| Governance Docs      | README governance section, `quickstart.md`, `PULL_REQUEST_TEMPLATE.md`                  | Manual review                                                      | DONE                                                                          | Developer workflow articulated.                                                                                                          |
| Metrics & Monitoring | `metrics-rollout.md`                                                                    | Manual                                                             | DONE                                                                          | KPIs & false positive logging defined.                                                                                                   |

## Traceability Notes

- Each FR maps to at least one implementation artifact and one test (except documentation / metrics which are non-code FR-adjacent deliverables).
- Partial: FR-010 re-addition nuance deferred; no impact on gate correctness for initial scope.

## Residual Enhancements (Non-blocking)

- FR-010 nuance: detect reintroduction of previously deprecated enum value (decide classification INFO vs new ADDITIVE).
- Historical commit resolution for exact firstCommit instead of approximation.
- Team slug expansion (@org/team) resolution for override evaluation.

---

Generated automatically via coverage mapping routine (manual curation step).
