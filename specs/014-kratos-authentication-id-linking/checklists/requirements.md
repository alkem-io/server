# Requirements Checklist: Kratos Authentication ID Linking

**Purpose**: Pre-review requirements quality gate for reviewers covering GraphQL backfill, internal REST endpoint, migrations, and logging.
**Created**: 2025-11-10
**Feature**: specs/014-kratos-authentication-id-linking/spec.md

**Note**: This checklist is generated by the `/speckit.checklist` command based on feature context and requirements.

## Requirement Completeness

- [ ] CHK001 Are migration requirements explicit about detecting/preventing pre-existing duplicate Kratos UUIDs before adding the nullable unique column? [Completeness, Spec §FR-001; Plan §Nullable Unique Column Strategy]
- [ ] CHK002 Do requirements enumerate every flow that must write `authenticationID` (onboarding, REST resolve, backfill) and state their triggers? [Completeness, Spec §FR-002; Spec §FR-005; Spec §User Story 1; Spec §User Story 3]
- [ ] CHK003 Are the admin backfill mutation result fields (processed/updated/skipped/retried) fully specified so reviewers can validate payload completeness? [Completeness, Contracts §admin-backfill-authentication-id.graphql; Spec §User Story 2]
- [ ] CHK004 Are REST error response codes and the conditions that produce 400/404/503 documented for reviewers to verify coverage? [Completeness, Spec §FR-005a; Contracts §authentication-id-lookup.yaml]

## Requirement Clarity

- [ ] CHK005 Is the "internal-only" REST access boundary described with concrete network or deployment constraints to avoid interpretation drift? [Clarity, Spec §NFR-001; Plan §Internal REST Endpoint Hardening]
- [ ] CHK006 Are logging requirements specific about which operations use `LogContext.AUTH` vs `LogContext.COMMUNITY` and what details must be included? [Clarity, Spec §FR-007; Plan §Observability]
- [ ] CHK007 Do requirements specify the exact audit log fields (e.g., caller IP, authenticationId, outcome) so logging expectations are measurable? [Clarity, Spec §NFR-001; Plan §Internal REST Endpoint Hardening]

## Requirement Consistency

- [ ] CHK008 Are the "link existing user" rules in FR-003 consistent with User Story 1 scenarios without conflicting edge-case outcomes? [Consistency, Spec §FR-003; Spec §FR-003a; Spec §User Story 1]
- [ ] CHK009 Do FR-006 and User Story 4 agree on when `authenticationID` must be cleared, including repeated delete invocations? [Consistency, Spec §FR-006; Spec §User Story 4]

## Acceptance Criteria Quality

- [ ] CHK010 Are acceptance scenarios for User Story 1 measurable enough to confirm uniqueness enforcement and duplicate rejection paths? [Acceptance Criteria, Spec §User Story 1; Spec §SC-001]
- [ ] CHK011 Does Success Criterion SC-002 define acceptable thresholds or evidence for the backfill mutation so reviewers can judge completion? [Acceptance Criteria, Spec §User Story 2; Spec §SC-002]

## Scenario Coverage

- [ ] CHK012 Are recovery behaviors for Kratos Admin API downtime or throttling described so all retry/failure scenarios are covered? [Coverage, Spec §Edge Cases; Plan §Backfill Execution Pattern]
- [ ] CHK013 Do requirements capture REST behavior when an identity email matches multiple platform users without authentication IDs? [Coverage, Spec §User Story 3; Spec §Edge Cases]
- [ ] CHK014 Are unlink flows documented for both successful removals and attempts on already-unlinked users to ensure idempotent coverage? [Coverage, Spec §User Story 4; Spec §Edge Cases]

## Edge Case Coverage

- [ ] CHK015 Is the conflict resolution for multiple Kratos identities sharing an email fully defined rather than just noted as an error? [Edge Case, Spec §Edge Cases]
- [ ] CHK016 Are malformed REST payload cases beyond invalid UUIDs (missing body, wrong type) addressed in requirements? [Edge Case, Spec §FR-005a; Contracts §authentication-id-lookup.yaml; Gap]

## Non-Functional Requirements

- [ ] CHK017 Do logging non-functional requirements constrain verbosity or retention to prevent backfill runs from overwhelming observability systems? [Non-Functional, Spec §NFR-002; Gap]
- [ ] CHK018 Are confidentiality expectations for REST errors and responses articulated so no Kratos internals leak? [Non-Functional, Spec §NFR-003]

## Dependencies & Assumptions

- [ ] CHK019 Are assumptions about Kratos Admin API token provisioning, rotation, and failure handling captured for operational readiness? [Dependencies, Spec §FR-004a; Plan §Technical Context; Gap]
- [ ] CHK020 Is reliance on the existing registration flow’s invariants documented so future changes don’t break identity linking? [Dependencies, Spec §User Story 3; Plan §Summary]

## Ambiguities & Conflicts

- [ ] CHK021 Is the tension between "no request-level guards" and secure deployment boundaries resolved with explicit operational controls? [Ambiguity, Spec §NFR-001; Plan §Internal REST Endpoint Hardening]
