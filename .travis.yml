language: node_js
node_js:
  - v16.15.0
env:
  matrix:
    - DATABASE_HOST=localhost MYSQL_DATABASE=alkemio MYSQL_ROOT_PASSWORD=toor NODE_OPTIONS="--max-old-space-size=2500"
cache:
  directories:
    - node_modules
install:
  - npm install
services:
  - mysql
before_install:
  - npm i -g npm@8.5.5
  - mysql -e 'CREATE DATABASE IF NOT EXISTS alkemio;'
before_script:
  - echo "USE mysql;ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password
    BY 'toor';;\nFLUSH PRIVILEGES;\n" | mysql -u root
script:
  - npm run test:ci
